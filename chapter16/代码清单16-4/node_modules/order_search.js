exports.get = function(req,res){
    req.session.destroy();
    res.render('order_search', {rows:new Array(),order:null}) 
};
exports.search=function(req,res,next){
    var d = domain.create();
    d.on('error', function(err) {
        next(err);
    });
    d.run(function(){
        db.connect(function(){
            var order={};
            if(req.method=="POST"){
                if(req.body.code){
                    order.code=req.body.code;
                    req.session.code=req.body.code;
                }
                else
                    req.session.code=null;
                if(req.body.date){
                    order.date=new Date(req.body.date);
                    req.session.date=req.body.date;
                }
                else
                    req.session.date=null;
                if(req.body.goodsCode){
                    order.goodsCode=req.body.goodsCode;
                    req.session.goodsCode=req.body.goodsCode;
                }
                else
                    req.session.goodsCode=null;
            }
            else{
                if(req.session.code){
                    order.code=req.session.code;
                }
                if(req.session.date){
                    order.date=new Date(req.session.date);
                } 
                if(req.session.goodsCode){
                    order.goodsCode=req.session.goodsCode;
                }
            }
            db.searchOrder(order,function(){
                db.disconnect();
                res.render('order_search', {rows:db.orders,order:order})
            });
        });
    });
};