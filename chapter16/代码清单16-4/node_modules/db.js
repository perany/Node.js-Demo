var mongoose = require('mongoose');
Schema = mongoose.Schema;
var orderSchema = new Schema({
    code:String,
    date:Date,
    goodsCode:String,
    brandName:String,
    num:Number,
    price:Number,
    personName:String,
    email:String
});
var Orders = mongoose.model('orders',orderSchema);
exports.connect=function(callback){
    mongoose.connect('mongodb://localhost:27017/myDatabase', 
    function(err){
        if(err) throw(err);
        else callback();
    });
};
exports.disconnect=function(){
    mongoose.disconnect();
};
exports.searchOrder=function(order,callback){
    Orders.find(order,function(err,orders) {
        if(err) throw(err);
        else{
            exports.orders=orders;
            callback();
        }
    });
};
exports.addOrder=function(order,callback){
    Orders.find({code:order.code},function(err,orders) {
        if(err) throw(err);
        else{
            if(orders.length>0){
                exports.errMsg="该订单编号已被占用。"
                callback();
            }
            else{
                Orders.create(order,function(err) {
                    if(err) throw(err);
                    else{   
                        exports.errMsg="";  
                        callback();                   
                    }
               });
            }
        }
    });
};
exports.updateOrder=function(order,callback){
    Orders.update({code:order.code},order,function(err){
        if(err) throw err;
        else callback();
    });
};
exports.deleteOrder=function(order,callback){
    Orders.findOne({code:order.code},function(err,order) {
        if(err) throw(err);
        else{
            order.remove();
            callback();
        }
    });
};